<div class="vulnerability-item {{ vuln.severity_class }}">
    <div class="vulnerability-header">
        <div class="vulnerability-meta">
            <div>
                <strong>{{ vuln.commit_message | split(pat='\n') | first | default(value="No message") }}</strong><br>
                {% if vuln.commit_url %}
                    <a href="{{ vuln.commit_url }}" target="_blank" class="commit-info">{{ vuln.commit_id_short }}</a>
                {% else %}
                    <span class="commit-info">{{ vuln.commit_id_short }}</span>
                {% endif %}
                {% if vuln.diff_url %}
                    â€¢ <a href="{{ vuln.diff_url }}" target="_blank" style="font-size: 0.8em;">view diff</a>
                {% endif %}
            </div>
            <div>
                <span class="risk-score {{ vuln.risk_class }}">{{ vuln.risk_score | round(precision=1) }}</span>
            </div>
        </div>
    </div>

    <!-- Details section -->
    <div class="vulnerability-details">
        <p><strong>Author:</strong> {{ vuln.author }}</p>
        <p><strong>Date:</strong> {{ vuln.date | date(format="%Y-%m-%d %H:%M:%S UTC") }}</p>

        {% if vuln.cve_references | length > 0 %}
            <p><strong>CVE References:</strong> {{ vuln.cve_references | join(sep=", ") }}</p>
        {% endif %}

        {% if vuln.patterns_matched | length > 0 %}
            <p><strong>Patterns Matched:</strong></p>
            <ul>
                {% for pattern in vuln.patterns_matched %}
                    <li>{{ pattern.pattern_name }} - {{ pattern.matched_text }}</li>
                {% endfor %}
            </ul>
        {% endif %}

        {% if vuln.files_changed | length > 0 %}
            <p><strong>Files Changed:</strong></p>
            <div class="file-list">
                {% if vuln.file_links | length > 0 %}
                    {% for file_link in vuln.file_links %}
                        <a href="{{ file_link.url }}" target="_blank" class="file-tag" style="text-decoration: none;">{{ file_link.path }}</a>
                    {% endfor %}
                {% else %}
                    {% for file in vuln.files_changed %}
                        <span class="file-tag">{{ file }}</span>
                    {% endfor %}
                {% endif %}
            </div>
        {% endif %}

        {% if vuln.issue_links | length > 0 %}
            <p><strong>Related Issues:</strong>
                {% for issue in vuln.issue_links %}
                    <a href="{{ issue.url }}" target="_blank">#{{ issue.number }}</a>
                    {% if not loop.last %}, {% endif %}
                {% endfor %}
            </p>
        {% endif %}
    </div>
</div>